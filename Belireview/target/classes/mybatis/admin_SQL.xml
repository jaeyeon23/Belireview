<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC " - //mybatis.org//DTD Config 3.0//EN" " http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">

<!-- User -->
	<!-- 전체 사용자 리스트를 보여줄 때, 검색시 -->
	<select id="selectUserList" resultType="hashmap" parameterType="hashmap">
		SELECT 
			*
		FROM
			member 
		<if test='searchNum != null'>
			<choose>
				<when test='searchNum == "id"'>
					WHERE id like '%'||#{searchBox}||'%'
				</when>
				<when test='searchNum == "name"'>
					WHERE name like '%'||#{searchBox}||'%'
				</when>
			</choose>
		</if>
		<if test='orderby != null'>
			<choose>
				<when test='orderby == 1'>
					order by member_no
				</when>
				<when test='orderby == 2'>
					order by id
				</when>
				<when test='orderby == 3'>
					order by name
				</when>
			</choose>
		</if>
	</select>

	<!-- 사용자 삭제시 확인 -->
	<select id="checkUser" resultType="int" parameterType="hashMap">
		SELECT
			count(*)
		FROM
			member
		WHERE
			id=#{id} and password=#{password}
	</select>
	
	<!-- 사용자 modify -->
	<select id="selectUserOne" resultType="hashmap" parameterType="string">
		SELECT
			*
		FROM
			member
		WHERE
			id=#{id}
	</select>
	
	<select id="selectUserOne_profile" resultType="string" parameterType="string">
		SELECT
			profile_image
		FROM
			member
		WHERE
			id=#{id, jdbcType=VARCHAR}	
	</select>
	
	<update id="updateUserOne_profile" parameterType="hashmap">
		UPDATE
			member 
		SET
			profile_image=#{profile_image, jdbcType=VARCHAR} 
		WHERE
			id=#{id, jdbcType=VARCHAR}
	</update>
	
	<update id="updateUserOne" parameterType="hashmap">
		UPDATE
			member
		SET
			<if test="profile_image != null">
				profile_image=#{profile_image},  
			</if>
			password=#{password}, name=#{name}, tel=#{tel}, 
			admin=to_number(#{admin}),
			email_marketing=to_number(#{email_marketing}), sms_marketing=to_number(#{sms_marketing}) 
		WHERE
			id=#{id}	
	</update>
	
	<delete id="deleteUserOne" parameterType="hashmap">
		DELETE
		FROM
			member
		WHERE
			id=#{id} and password=#{password}
	</delete>
	
	<!-- Drama -->
	<select id="selectNextVal" resultType="int">
		<!-- SELECT
			LAST_NUMBER 
		FROM
			USER_SEQUENCES 
		WHERE
			SEQUENCE_NAME = 'SEQ_DRAMA_NO'	 -->
			
		select seq_drama_no.nextval from dual      
	</select>
	
	<select id="selectDramaList" resultType="hashmap" parameterType="hashmap">
		SELECT
			*
		FROM
			drama
		<if test='searchNum != null'>
			<choose>
				<when test='searchNum == "director"'>
					WHERE DRAMA_DIRECTOR like '%'||#{searchBox}||'%' 
				</when>
				<when test='searchNum == "genre"'>
					WHERE DRAMA_GENRE like '%'||#{searchBox}||'%'
				</when>
				<when test='searchNum == "channel"'>
					WHERE DRAMA_CHANNEL like '%'||#{searchBox}||'%'
				</when>
				<when test='searchNum == "name"'>
					WHERE DRAMA_NAME like '%'||#{searchBox}||'%'
				</when>
			</choose>
		</if>
		<if test='orderby != null'>
			<choose>
				<when test='orderby == 1'>
					order by DRAMA_READCOUNT DESC
				</when>
				<when test='orderby == 2'>
					order by DRAMA_EPISODE DESC
				</when>
				<when test='orderby == 3'>
					order by DRAMA_EPISODE
				</when>
				<when test='orderby == 4'>
					order by DRAMA_GRADE DESC
				</when>
				<when test='orderby == 5'>
					order by DRAMA_GRADE
				</when>
			</choose>
		</if>
	</select>
	
	<select id="selectDramaOne" parameterType="Integer" resultType="hashmap">
		SELECT
			*
		FROM
			drama
		WHERE
			drama_no=#{no}
	</select>
	
	<insert id="writeDrama" parameterType="hashmap">
		INSERT INTO DRAMA(
			drama_no,
			drama_name,
			drama_date,
			drama_channel,
			drama_genre,
			drama_director,
			drama_content,
			drama_poster_image,
			drama_main_image,
			drama_content_image,
			drama_episode
		)
		VALUES(
			SEQ_DRAMA_NO.CURRVAL, 
			#{name},
			TO_DATE(#{date}),
			#{channel},
			#{genre},
			#{director},
			#{content},
			#{poster_image},
			#{main_image},
			#{content_image},
			#{episode}
		)			
	</insert>
	
	<!-- 미완성 -->
<!-- 	<select id="checkDrama" resultType="int" parameterType="hashMap">
		SELECT
			count(*)
		FROM
			drama 
		WHERE
			drama_no=#{no}
	</select> -->
</mapper>
