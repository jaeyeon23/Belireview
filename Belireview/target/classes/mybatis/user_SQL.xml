<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user">

	<select id="UserMovieAll" parameterType="hashmap" resultType="hashmap">
		SELECT
			MOVIE_NO,
			MOVIE_NAME,
			MOVIE_DATE,
			MOVIE_POSTER_IMAGE,
			TO_CHAR(MOVIE_GRADE,'0.0') AS MOVIE_GRADE,
			RNUM
		FROM
		(
		SELECT 
			MOVIE_NO,
			MOVIE_NAME,
			MOVIE_DATE,
			MOVIE_POSTER_IMAGE,
			MOVIE_GRADE,
			ROWNUM RNUM
		FROM MOVIE 
		WHERE MOVIE_NO IN 
			(SELECT MOVIE_LIKE_NO
			FROM MOVIE_LIKE
			WHERE ID=#{ID}) ORDER BY MOVIE_DATE)
	</select>
	
	<select id="userWishList" parameterType="hashmap" resultType="hashmap"><!-- 보고싶어요 -->
		select * from mypage where mypage_id=#{ID}
	</select>
	
	<insert id="insertWishList" parameterType="hashmap"> <!-- 보고싶어요 저장-->
		insert into mypage
		<choose>
		    <when  test='movie_no != null'>
		      	(mypage_id,mypage_movie) values(#{ID},#{MOVIE_NO})
		    </when>
		    <otherwise>
		     	(mypage_id,mypage_drama) values(#{ID},#{DRAMA_NO})
		    </otherwise>
	 	</choose>
	</insert>
	
	<update id="updateWishList" parameterType="hashmap"><!-- 보고싶어요 수정-->
		update mypage set 
		<choose>
			<when  test='movie_no != null'>
		      	mypage_movie=#{MOVIE_NO}
		    </when>
		    <otherwise>
		     	mypage_drama=#{DRAMA_NO}
		    </otherwise>
	    </choose>
	    where mypage_id=#{ID}
	</update>

	<!-- 수정후회원정보불러오기 -->
	<select id="UserGo" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT * FROM MEMBER WHERE ID=#{id}
		]]>
	</select>
	
	<!-- 회원정보수정 -->
	<update id="changeUser" parameterType="hashmap">
		<![CDATA[
		UPDATE MEMBER
        SET 
            NAME = #{name},
            PASSWORD = #{password},
            TEL = #{tel},
            EMAIL = #{email},
            EMAIL_MARKETING = #{email_marketing},
            SMS_MARKETING = #{sms_marketing}                      
    	WHERE ID = #{id}
		]]>
	</update>
	
	<select id="selectUserGrade" parameterType="hashmap" resultType="hashmap">	
	SELECT 
		(SELECT
		 MOVIE_NAME
	FROM MOVIE 
	WHERE
		MOVIE_NO = MOVIE_LIKE_NO)
		MOVIE_NAME,
(SELECT
		 MOVIE_POSTER_IMAGE
	FROM MOVIE 
	WHERE
		MOVIE_NO = MOVIE_LIKE_NO) IMAGE,
		ID,
		TO_CHAR(ML_GRADE,'0.0') AS ML_GRADE,
		RNUM
	FROM(
	SELECT 
		MOVIE_LIKE_NO,
		ID,
		ML_GRADE,
		ROWNUM RNUM
	FROM MOVIE_LIKE
	WHERE ID=#{ID}) 
	WHERE RNUM BETWEEN 1 AND 10
	</select>
	
	<select id="userDramaList" parameterType="hashmap" resultType="hashmap">
		SELECT
				DRAMA_NO,
				DRAMA_NAME,
				DRAMA_POSTER_IMAGE,
	    FROM 
				DRAMA
		WHERE DRAMA_NO IN 
		<foreach collection="codeList" item="a" open="(" close=")" separator=",">
			#{a}
		</foreach>
		
   </select>
   
   <select id="userMovieList" parameterType="hashmap" resultType="hashmap">
		SELECT
				MOVIE_NO,
				MOVIE_NAME,
				MOVIE_POSTER_IMAGE,
	    FROM 
				MOVIE
		WHERE MOVIE_NO IN 
		<foreach collection="a" item="s" open="(" close=")" separator=",">
			#{s}
		</foreach>
		
   </select>

	
</mapper>